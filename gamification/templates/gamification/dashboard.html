{% extends "base.html" %}
{% block content %}

<h1>ğŸŒ± Garden Dashboard</h1>

<h2>Garden Health</h2>
<p id="garden-health"></p>
<p id="garden-theme"></p>

<h2>Your Plants</h2>
<ul id="plant-list"></ul>

<h2>Login Streak</h2>
<p id="streak-count"></p>

<h2>Badges</h2>
<ul id="badge-list"></ul>

<hr>
<h2>ğŸ“Š Test Progress Overview</h2>

<ul>
  {% for progress in test_progress %}
    <li>
      <strong>{{ progress.title }}</strong>

      <ul>
        {% for s in progress.skillsets %}
          <li>
            {% if s.completed %}
              âœ… {{ s.title }}
            {% else %}
              âŒ {{ s.title }}
            {% endif %}
          </li>
        {% endfor %}
      </ul>

      <p>
        {% if progress.unlocked %}
          âœ… Test Unlocked
        {% else %}
          ğŸ”’ Locked â€“ Complete all SkillSets
        {% endif %}
      </p>

      <p>
        Readiness:
        {% if progress.readiness == "ready" %}
          âœ… Ready
        {% elif progress.readiness == "needs_review" %}
          âš ï¸ Needs Review
        {% else %}
          ğŸ”’ Locked
        {% endif %}
      </p>
    </li>
  {% endfor %}
</ul>

<hr>
<h2>ğŸ“‹ SkillSet Readiness Overview</h2>

<ul>
  {% for s in skillset_status %}
    <li>
      {{ s.title }} â€”
      {% if s.readiness == "ready" %}
        âœ… Ready
      {% else %}
        âš ï¸ Needs Review
      {% endif %}
    </li>
  {% endfor %}
</ul>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    fetch("/api/gamification/dashboard/")
      .then(res => res.json())
      .then(data => {
        document.getElementById("garden-health").innerText = "Health: " + data.garden.health_score + "%";
        document.getElementById("garden-theme").innerText = "Theme: " + data.garden.visual_theme;

        data.plants.forEach(p => {
          const li = document.createElement("li");
          li.innerText = `${p.category} â€“ ${p.growth_stage}`;
          document.getElementById("plant-list").appendChild(li);
        });

        document.getElementById("streak-count").innerText =
          `Current: ${data.streak.current_streak}, Longest: ${data.streak.longest_streak}`;

        data.badges.forEach(b => {
          const li = document.createElement("li");
          li.innerText = `${b.badge_type} (Unlocked on ${new Date(b.unlocked_on).toLocaleDateString()})`;
          document.getElementById("badge-list").appendChild(li);
        });
      });
  });
</script>

{% endblock %}
